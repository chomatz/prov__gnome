---

- name: ensure tasks run only on selected os releases
  block:

    - name: install gnome groups
      ansible.builtin.debug:
        msg: |
          ----------------------------
          install gnome related groups
          ----------------------------
        verbosity: 0
      delegate_to: localhost
      run_once: true

    - name: install groups
      ansible.builtin.package:
        name: "{{ gnome.groups }}"
        state: latest
      register: gnome_groups
      failed_when:
        - gnome_groups is failed
        - "'No group GNOME available' not in gnome_groups.msg"

    - name: display gnome groups installation result
      ansible.builtin.debug:
        var: gnome_groups
        verbosity: 1

    - name: install gnome packages
      ansible.builtin.debug:
        msg: |
          ----------------------------
          install extra gnome pacakges
          ----------------------------
        verbosity: 0
      delegate_to: localhost
      run_once: true

    - name: install packages
      ansible.builtin.package:
        name: "{{ gnome.packages }}"
        state: latest

    - name: graphical boot
      ansible.builtin.debug:
        msg: |
          --------------------------------------
          set system to boot into graphical mode
          --------------------------------------
        verbosity: 0
      delegate_to: localhost
      run_once: true

    - name: check default systemd target
      ansible.builtin.command:
        cmd: systemctl get-default
      changed_when: false
      register: cmd_systemd_target

    - name: set system to boot the graphical.target
      ansible.builtin.command:
        cmd: "systemctl set-default graphical.target"
      when: cmd_systemd_target.stdout != "graphical.target"

  when: >
    ansible_distribution == "CentOS" or
    ansible_distribution == "Fedora" or
    ansible_distribution == "RedHat" or
    ansible_distribution == "Rocky"

...
